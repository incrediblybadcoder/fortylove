name: $(SourceBranchName)_$(date:yyyyMMdd)$(rev:.r)

trigger:
  branches:
    include:
      - main
      - develop

pool:
  vmImage: 'ubuntu-latest'

variables:
  ${{ if and(eq(variables['Build.Reason'], 'PullRequest'), eq(variables['System.PullRequest.TargetBranch'], 'refs/heads/main')) }}:
    artifactName: "fortylove_main"
  ${{ elseif and(eq(variables['Build.Reason'], 'PullRequest'), eq(variables['System.PullRequest.TargetBranch'], 'refs/heads/develop')) }}:
    artifactName: "fortylove_develop"

steps:
  - task: PowerShell@2
    inputs:
      targetType: "inline"
      script: |
        Write-Host "======================================================================="
        Write-Host "PRINTING VARIABLES"
        Write-Host "======================================================================="
        Write-Host "SourceBranchName: $(Build.SourceBranchName)"
        Write-Host "-----------------------------------------------------------------------"
        Write-Host "artifactName: $(artifactName)"
        Write-Host "======================================================================="
    displayName: "Print Deployment Variables"

  - task: DownloadPipelineArtifact@2
    inputs:
      buildType: "specific"
      project: "e6858bfb-b65c-4bd5-a31a-631bcc276778"
      definition: "9"
      specificBuildWithTriggering: true
      buildVersionToDownload: "latest"
      artifactName: $(variables.artifactName)
      targetPath: "$(Pipeline.Workspace)"
    displayName: "Download $(artifactName) Build Artifact"

  - task: AzureWebApp@1
    inputs:
      azureSubscription: "Azure subscription 1(1)(f0a71b7c-089b-4b57-9427-2171fc0aee67)"
      appType: "webAppLinux"
      appName: "fortylove"
      package: "$(Pipeline.Workspace)/fortylove-0.0.1-SNAPSHOT.jar"
      runtimeStack: "JAVA|17-java17"